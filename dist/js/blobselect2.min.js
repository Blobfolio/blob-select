!function(){function _clone(src){if(!src||"object"!=typeof src||"[object Function]"===Object.prototype.toString.call(src))return src;if(src.nodeType&&"cloneNode"in src)return src.cloneNode(!0);if(src instanceof Date)return new Date(src.getTime());if(src instanceof RegExp)return new RegExp(src);var r,i,l;if(src instanceof Array)for(r=[],i=0,l=src.length;i<l;++i)i in src&&r.push(_clone(src[i]));else r=src.constructor?new src.constructor:{};return function(dest,source,copyFunc){var name,s,empty={};for(name in source)s=source[name],name in dest&&(dest[name]===s||name in empty&&empty[name]===s)||(dest[name]=copyFunc?copyFunc(s):s);return dest}(r,src,_clone)}function _cast(value,type){var valueType=typeof value;if(valueType===type)return value;switch(type){case"string":try{value=value?String(value):""}catch(Ex){value=""}break;case"number":try{value="boolean"===valueType?value?1:0:Number(value)}catch(Ex){value=0}break;case"boolean":try{if("string"===valueType){var valueLower=value.toLowerCase();-1!==["off","0","false"].indexOf(valueLower)?value=!1:-1!==["on","1","true"].indexOf(valueLower)&&(value=!0)}value=!!value}catch(Ex){value=!1}}return value}function _isObject(value){var valueType=typeof value;return"undefined"!==valueType&&null!==value&&"object"===valueType}function _parseArgs(args,defaults,strict){if("object"!=typeof defaults)return{};if("object"!=typeof args)return defaults;strict=null===strict||void 0===strict||!!strict;var parsed=_clone(defaults),keys=Object.keys(args),keysLength=keys.length;if(!keysLength)return parsed;for(i=0;i<keysLength;i++)if(void 0!==parsed[keys[i]]){var argValue=_clone(args[keys[i]]);if(strict&&null!==parsed[keys[i]]){var argType=typeof argValue,defaultType=typeof parsed[keys[i]];argType!==defaultType&&(argValue=_cast(argValue,defaultType))}parsed[keys[i]]=argValue}return parsed}function _parseJSON(str){if("object"==typeof str)return str;try{var j=_JSON5.parse(str);if(null!==j)return j}catch(Ex){console.warn(Ex)}return{}}function _sanitizeRegExp(str){try{return(str+="").replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}catch(Ex){}return""}function _sanitizeWhitespace(str){try{return(str+="").replace(/\s{1,}/g," ").trim()}catch(Ex){}return""}function _find(el,selector){var out=[];try{selector+="";var results=el.querySelectorAll(selector);if(results.length)for(i=0;i<results.length;i++)out.push(results.item(i))}catch(Ex){}return out}function _closest(el,selector){try{if(selector+="",el.matches(selector))return el;for(;el.parentNode&&"matches"in el.parentNode;)if((el=el.parentNode).matches(selector))return el}catch(Ex){}return!1}function _removeElement(el){!Array.isArray(el)&&el instanceof HTMLElement&&(el=[el]);var keys;try{keys=Object.keys(el)}catch(Ex){return}for(i=keys.length-1;i>=0;i--)if(el[keys[i]]instanceof HTMLElement){try{var fieldEvents=getEventListeners(el[keys[i]]);for(j=0;j<fieldEvents.length;j++)fieldEvents[j].remove()}catch(Ex){}el[keys[i]].parentNode.removeChild(el[keys[i]])}}function _sortStringAsc(a,b){return a.placeholder?-1:b.placeholder?1:a.label.toLowerCase()<b.label.toLowerCase()?-1:1}function _sortStringDesc(a,b){return a.placeholder?-1:b.placeholder?1:a.label.toLowerCase()>b.label.toLowerCase()?-1:1}function _sortNumericAsc(a,b){return a.placeholder?-1:b.placeholder?1:(Number(a.label.replace(/[^\d\.]/g,""))||0)<(Number(b.label.replace(/[^\d\.]/g,""))||0)?-1:1}function _sortNumericDesc(a,b){return a.placeholder?-1:b.placeholder?1:(Number(a.label.replace(/[^\d\.]/g,""))||0)>(Number(b.label.replace(/[^\d\.]/g,""))||0)?-1:1}function _cursorToEnd(el){var searchSelection,searchRange=document.createRange();searchRange.selectNodeContents(el),searchRange.collapse(!1),(searchSelection=window.getSelection()).removeAllRanges(),searchSelection.addRange(searchRange)}function _isPrintableKey(key){return key>47&&key<58||key>64&&key<91||key>95&&key<112||key>185&&key<193||key>218&&key<223}function _hash(key,seed){var remainder,bytes,h1,h1b,c1,c2,k1,i;for("object"==typeof key?key=JSON.stringify(key):key+="",remainder=3&key.length,bytes=key.length-remainder,h1=seed,c1=3432918353,c2=461845907,i=0;i<bytes;)k1=255&key.charCodeAt(i)|(255&key.charCodeAt(++i))<<8|(255&key.charCodeAt(++i))<<16|(255&key.charCodeAt(++i))<<24,++i,h1=27492+(65535&(h1b=5*(65535&(h1=(h1^=k1=(65535&(k1=(k1=(65535&k1)*c1+(((k1>>>16)*c1&65535)<<16)&4294967295)<<15|k1>>>17))*c2+(((k1>>>16)*c2&65535)<<16)&4294967295)<<13|h1>>>19))+((5*(h1>>>16)&65535)<<16)&4294967295))+((58964+(h1b>>>16)&65535)<<16);switch(k1=0,remainder){case 3:k1^=(255&key.charCodeAt(i+2))<<16;break;case 2:k1^=(255&key.charCodeAt(i+1))<<8;break;case 1:h1^=k1=(65535&(k1=(k1=(65535&(k1^=255&key.charCodeAt(i)))*c1+(((k1>>>16)*c1&65535)<<16)&4294967295)<<15|k1>>>17))*c2+(((k1>>>16)*c2&65535)<<16)&4294967295}return h1^=key.length,h1^=h1>>>16,h1=2246822507*(65535&h1)+((2246822507*(h1>>>16)&65535)<<16)&4294967295,h1^=h1>>>13,h1=3266489909*(65535&h1)+((3266489909*(h1>>>16)&65535)<<16)&4294967295,(h1^=h1>>>16)>>>0}if("classList"in document.documentElement&&"createRange"in document&&"querySelector"in document&&"querySelectorAll"in document&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON){Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(s){for(var matches=(this.document||this.ownerDocument).querySelectorAll(s),i=matches.length;--i>=0&&matches.item(i)!==this;);return i>-1});var settings={orderType:"",order:"ASC",placeholder:"---",placeholderOption:"---",search:!1,watch:0,debug:!1},flags={blobselectOrderType:"blobselect-order-type",blobselectOrder:"blobselect-order",blobselectPlaceholder:"blobselect-placeholder",blobselectPlaceholderOption:"blobselect-placeholder-option",blobselectSearch:"blobselect-search",blobselectWatch:"blobselect-watch",blobselectDebug:"blobselect-debug"},blobSelect=function(el){this.$element=el},clickOutside=!1;blobSelect.prototype={_:this,$element:null,$lock:!1,$me:{disabled:!1,multiple:!1,required:!1,state:"closed"},$search:"",$settings:{},$watch:0,$items:[],$itemsHash:0,$disabledItems:[],$selectedItems:[],container:null,button:null,items:null,search:null,selections:null,isInitialized:function(){return this.container instanceof HTMLDivElement},hasElement:function(){return this.$element instanceof HTMLSelectElement},init:function(args){if(this.isInitialized())return this.debug("Already initialized; init() aborted.");args=this.parseSettings(args),this.saveSettings(args),this.buildContainer(),this.buildData()},destroy:function(args){if(!this.isInitialized())return this.debug("Not initialized; destroy() aborted.");null!==this.search&&_removeElement(this.search),_removeElement(_find(this.items,".blobselect-item-group, .blobselect-item")),this.container.parentNode.insertBefore(this.$element,this.container),_removeElement(this.container),this.container=null,this.button=null,this.items=null,this.search=null,this.selections=null,this.$items=[],this.$selectedItems=[],this.$disabledItems=[],this.$itemsHash=0,this.debug("blobSelect removed.")},parseSettings:function(args){if(!this.hasElement())return{};"string"==typeof args&&args?args=_parseJSON(args):_isObject(args)||(args={}),this.$element.dataset.blobselect&&(args=_parseJSON(this.$element.dataset.blobselect));var flagsKeys=Object.keys(flags);for(i=0;i<flagsKeys.length;i++)this.$element.dataset[flagsKeys[i]]&&(args[flagsKeys[i].substr(10,1).toLowerCase()+flagsKeys[i].substr(11)]=this.$element.dataset[flagsKeys[i]],this.$element.removeAttribute(flags[flagsKeys[i]]),this.$element.removeAttribute("data-"+flags[flagsKeys[i]]));return args},saveSettings:function(args){if(!this.hasElement())return!1;var parsed=_parseArgs(args,settings,!0);if(parsed.orderType&&(parsed.orderType=parsed.orderType.toLowerCase(),-1===["string","numeric"].indexOf(parsed.orderType)&&(parsed.orderType="")),parsed.order=parsed.order.toUpperCase(),-1===["ASC","DESC"].indexOf(parsed.order)&&(parsed.order="ASC"),parsed.placeholder=_sanitizeWhitespace(parsed.placeholder),parsed.placeholderOption=_sanitizeWhitespace(parsed.placeholderOption),parsed.watch=parseInt(parsed.watch,10)||0,parsed.watch<0&&(parsed.watch=0),this.$settings=parsed,this.$watch&&clearInterval(this.$watch),this.$settings.watch){var me=this;this.$watch=setInterval(function(){me.buildData()},this.$settings.watch)}var settingsString=JSON.stringify(this.$settings);return this.$element.setAttribute("data-blobselect",settingsString),this.debug("Parsed settings: "+settingsString),!0},buildData:function(){if(!this.hasElement())return this.debug("Not initialized; buildData() aborted.");var tmp={disabled:this.$element.disabled,required:this.$element.required,multiple:this.$element.multiple,items:[]},selected=[],disabled=[];tmp.disabled!==this.$me.disabled&&(this.$me.disabled=tmp.disabled,this.container.classList.toggle("is-disabled",tmp.disabled)),tmp.required!==this.$me.required&&(this.$me.required=tmp.required,this.container.classList.toggle("is-required",tmp.required)),tmp.multiple!==this.$me.multiple&&(this.$me.multiple=tmp.multiple,this.container.classList.toggle("is-multiple",tmp.multiple));var row,rows,options,optgroups=_find(this.$element,"optgroup");if(optgroups.length){for(i=0;i<optgroups.length;i++){for(v=optgroups[i],_sanitizeWhitespace((row={label:v.label||v.textContent||"",value:"",type:"optgroup",disabled:v.disabled,selected:!1,placeholder:!1,focused:!1,grouped:!1}).label),tmp.items.push(row),rows=[],options=v.querySelectorAll("option"),j=0;j<options.length;j++)v2=options.item(j),_sanitizeWhitespace((row={label:v2.label||v2.textContent||"",value:v2.value,type:"option",disabled:v2.disabled||v.disabled,selected:v2.selected,placeholder:!1,focused:!1,grouped:!0}).label),row.placeholder=!row.label.length||1===parseInt(v2.dataset.placeholder,10)||row.label.toLowerCase()===this.$settings.placeholderOption.toLowerCase(),rows.push(row);for(rows=this.sort(rows),j=0;j<rows.length;j++)tmp.items.push(rows[j])}for(rows=[],i=0;i<this.$element.children.length;i++)v2=this.$element.children[i],"OPTION"===v2.tagName&&(_sanitizeWhitespace((row={label:v2.label||v2.textContent||"",value:v2.value,type:"option",disabled:v2.disabled,selected:v2.selected,placeholder:!1,focused:!1,grouped:!1}).label),row.placeholder=!row.label.length||1===parseInt(v2.dataset.placeholder,10)||row.label.toLowerCase()===this.$settings.placeholderOption.toLowerCase(),row.placeholder?tmp.items.unshift(row):rows.push(row));for(rows=this.sort(rows),i=0;i<rows.length;i++)tmp.items.push(rows[i])}else{for(options=_find(this.$element,"option"),i=0;i<options.length;i++)v2=options[i],_sanitizeWhitespace((row={label:v2.label||v2.textContent||"",value:v2.value,type:"option",disabled:v2.disabled,selected:v2.selected,placeholder:!1,grouped:!1}).label),row.placeholder=!row.label.length||1===parseInt(v2.dataset.placeholder,10)||row.label.toLowerCase()===this.$settings.placeholderOption.toLowerCase(),tmp.items.push(row);tmp.items=this.sort(tmp.items)}var hash=_hash(tmp);if(hash!==this.$itemsHash){for(this.$items=tmp.items,i=0;i<this.$items.length;i++)this.$items[i].disabled?disabled.push(i):this.$items[i].selected&&selected.push(i);this.$selectedItems=selected,this.$disabledItems=disabled,this.$itemsHash=hash,this.debug("Recalculated data."),this.buildItems(),this.buildSelections()}},buildContainer:function(){null!==this.container&&this.debug("Container already exists; buildContainer() aborted."),this.container=document.createElement("div"),this.container.classList.add("blobselect"),this.$me.multiple&&this.container.classList.add("is-multiple"),this.$me.required&&this.container.classList.add("is-required"),this.$me.disabled&&this.container.classList.add("is-disabled"),this.container.tabIndex=this.$element.tabIndex||0,this.$element.parentNode.insertBefore(this.container,this.$element),this.debug("Built container."),this.selections=document.createElement("div"),this.selections.classList.add("blobselect-selections"),this.container.appendChild(this.selections),this.container.appendChild(this.$element),this.button=document.createElement("div"),this.button.classList.add("blobselect-button"),this.container.appendChild(this.button),this.items=document.createElement("div"),this.items.classList.add("blobselect-items"),this.container.appendChild(this.items),this.buildSearch();var me=this;clickOutside||document.querySelector("html").addEventListener("click",_clickOutside),this.$element.addEventListener("change",function(){me.$lock||(me.debug("Element change event fired."),me.buildData())}),this.container.addEventListener("click",function(e){return me.containerClick(e)}),this.container.addEventListener("keyup",function(e){return me.containerKey(e)})},buildSearch:function(){if(!this.isInitialized())return!1;this.$settings.search||null===this.search?this.$settings.search&&null===this.search&&(this.search=document.createElement("div"),this.search.classList.add("blobselect-item-search"),this.search.setAttribute("type","text"),this.search.setAttribute("contentEditable","true"),this.search.tabIndex=0,this.items.firstChild?this.items.insertBefore(this.search,this.items.firstChild):this.items.appendChild(this.search),this.debug("Search field built.")):(_removeElement(this.search),this.search=null,this.debug("Search field removed."))},buildItems:function(force){if(null!==this.items){force=!!force,this.$search="";var tmp,me=this;if(!force){var oldValues=[],newValues=[];for(i=0;i<this.$items.length;i++)"optgroup"===this.$items[i].type?value="_optgroup_"+this.$items[i].label:value=this.$items[i].value,newValues.push(value);for(i=0;i<this.items.children.length;i++)value=null,this.items.children[i].classList.contains("blobselect-item")?value=this.items.children[i].dataset.value:this.items.children[i].classList.contains("blobselect-item-group")&&(value="_optgroup_"+this.items.children[i].dataset.label),null!==value&&oldValues.push(value);newValues.length===oldValues.length&&_hash(newValues)===_hash(oldValues)||(force=!0)}if(force){this.debug("Rebuilding menu items.");var newItems=[],tabIndex=1;for(i=0;i<this.$items.length;i++)tmp=document.createElement("div"),"optgroup"===this.$items[i].type?(tmp.classList.add("blobselect-item-group"),tmp.textContent=this.$items[i].label):(tabIndex++,tmp.tabIndex=tabIndex,tmp.classList.add("blobselect-item"),this.$items[i].placeholder?(tmp.classList.add("is-placeholder"),tmp.textContent=this.$settings.placeholderOption):tmp.textContent=this.$items[i].label,this.$items[i].grouped&&tmp.classList.add("has-group"),this.$items[i].selected&&tmp.classList.add("is-active")),this.$items[i].disabled&&tmp.classList.add("is-disabled"),tmp.setAttribute("data-type",this.$items[i].type),tmp.setAttribute("data-value",this.$items[i].value),tmp.setAttribute("data-label",this.$items[i].label),newItems.push(tmp);for(_removeElement(_find(this.items,".blobselect-item, .blobselect-item-group")),i=0;i<newItems.length;i++)this.items.appendChild(newItems[i]),"optgroup"!==newItems[i].dataset.type&&(newItems[i].addEventListener("focus",function(e){me.items.setAttribute("data-focused",_find(me.items,".blobselect-item").indexOf(e.target)),e.target.classList.add("is-focused")}),newItems[i].addEventListener("blur",function(e){e.target.classList.remove("is-focused")}))}else{this.debug("Updating menu items.");var key=-1;for(i=0;i<this.items.children.length;i++)if(this.items.children[i].classList.contains("blobselect-item")||this.items.children[i].classList.contains("blobselect-item-group")){if(key++,this.$items[key].placeholder!==this.items.children[i].classList.contains("is-placeholder")&&this.items.children[i].classList.toggle("is-placeholder",this.$items[key].placeholder),this.$items[key].disabled!==this.items.children[i].classList.contains("is-disabled")&&this.items.children[i].classList.toggle("is-disabled",this.$items[key].disabled),this.$items[key].grouped!==this.items.children[i].classList.contains("has-group")&&this.items.children[i].classList.toggle("has-group",this.$items[key].grouped),this.$items[key].selected!==this.items.children[i].classList.contains("is-active")&&this.items.children[i].classList.toggle("is-active",this.$items[key].selected),this.$items[key].label!==this.items.children[i].dataset.label&&this.items.children[i].setAttribute("data-label",this.$items[key].label),this.$items[key].value!==this.items.children[i].dataset.value&&this.items.children[i].setAttribute("data-value",this.$items[key].value),this.$items[key].type!==this.items.children[i].dataset.type){if("optgroup"===this.$items[key].type){this.items.children[i].classList.add("blobselect-item-group"),this.items.children[i].classList.remove("blobselect-item");try{var fieldEvents=getEventListeners(this.items.children[i]);for(j=0;j<fieldEvents.length;j++)fieldEvents[j].remove()}catch(Ex){}}else this.items.children[i].classList.add("blobselect-item-group"),this.items.children[i].classList.remove("blobselect-item"),this.items.children[i].addEventListener("focus",function(e){me.items.setAttribute("data-focused",_find(me.items,".blobselect-item").indexOf(e.target)),e.target.classList.add("is-focused")}),this.items.children[i].addEventListener("blur",function(e){e.target.classList.remove("is-focused")});this.items.children[i].setAttribute("data-type",this.$items[key].type)}var textContent=this.$items[key].label;this.$items[key].placeholder&&(textContent=this.$settings.placeholderOption),textContent!==this.items.children[i].textContent&&(this.items.children[i].textContent=textContent)}}this.debug("Menu items have been "+(force?"rebuilt":"updated")+".")}},buildSelections:function(force){if(null!==this.selections){var tmp;if(!(force=!!force)){var oldValues=[],newValues=[];for(i=0;i<this.$selectedItems.length;i++)newValues.push(this.$items[this.$selectedItems[i]].value);for(i=0;i<this.selections.children.length;i++)this.selections.children[i].classList.contains("blobselect-selection")&&oldValues.push(this.selections.children[i].dataset.value);oldValues.length===newValues.length&&_hash(oldValues)===_hash(newValues)||(force=!0)}if(force){this.debug("Rebuilding selections.");var newItems=[];for(i=0;i<this.$selectedItems.length;i++)(tmp=document.createElement("div")).classList.add("blobselect-selection"),tmp.setAttribute("data-value",this.$items[this.$selectedItems[i]].value),tmp.setAttribute("data-label",this.$items[this.$selectedItems[i]].label),this.$items[this.$selectedItems[i]].placeholder?(tmp.textContent=this.$settings.placeholder,tmp.classList.add("is-placeholder")):tmp.textContent=this.$items[this.$selectedItems[i]].label,newItems.push(tmp);for(newItems.sort(function(a,b){var atext=a.textContent,btext=b.textContent;return atext===btext?0:atext<btext?-1:1}),_removeElement(_find(this.selections,".blobselect-selection")),i=0;i<newItems.length;i++)this.selections.appendChild(newItems[i]);return this.debug("Selections have been "+(force?"rebuilt":"updated")+".")}this.debug("Selections have not changed.")}},containerClick:function(e){if(e.stopPropagation(),this.container.classList.contains("is-disabled")){if(this.debug("Click ignored; field is disabled."),"open"===this.$me.state)return this.close()}else{if(this.debug("Clicked."),e.target.classList.contains("blobselect-selection")&&this.$me.multiple)return this.unselect(e.target);if(e.target!==this.$element)if(e.target.classList.contains("blobselect-item-search"))this.search.setAttribute("contentEditable","true");else{if(!e.target.classList.contains("blobselect-item"))return"closed"===this.$me.state?this.open():this.close();e.target.classList.contains("is-disabled")||this.select(e.target)}}},containerKey:function(e){var key=e.keyCode,keyMapped={8:"backspace",9:"tab",13:"enter",27:"escape",32:"space",37:"left",38:"up",39:"right",40:"down"}[key]||"other",keyPrintable=_isPrintableKey(key);if("closed"===this.$me.state){if(-1===["tab","backspace"].indexOf(keyMapped))return e.stopPropagation(),this.$settings.search&&keyPrintable&&(this.search.textContent=String.fromCharCode(key).toLowerCase(),this.$search="",this.filterItems()),this.open()}else{if("escape"===keyMapped)return e.stopPropagation(),this.close();if("enter"===keyMapped){e.stopPropagation(),e.preventDefault(),this.$search&&(this.search.innerHTML=_sanitizeWhitespace(this.search.textContent),this.$search=this.search.textContent);var choice=this.getActiveItem();return choice?this.select(choice):this.close()}if(-1!==["tab","up","down","left","right"].indexOf(keyMapped)){if(e.stopPropagation(),e.target.classList.contains("blobselect-item-search")){if(-1!==["tab","up","down"].indexOf(keyMapped))return this.traverseItems("current");return}var direction=-1!==["tab","down","right"].indexOf(keyMapped)?"next":"back";return this.traverseItems(direction)}if(e.target.classList.contains("blobselect-item-search")){e.stopPropagation();var searchText=_sanitizeWhitespace(this.search.textContent).toLowerCase();if(searchText!==this.$search)return this.$search=searchText,this.filterItems();return}}},open:function(){if(this.isInitialized()&&"open"!==this.$me.state&&"opening"!==this.$me.state){var selects=_find(document,".blobselect.is-open select");for(i=0;i<selects.length;i++)selects[i].blobSelect.close();var me=this;return this.items.setAttribute("data-focused",-1),this.container.classList.add("is-opening"),this.$me.state="opening",setTimeout(function(){me.$me.state="open",me.container.classList.add("is-open"),me.container.classList.remove("is-opening")},50),this.$settings.search&&(this.search.setAttribute("contentEditable","true"),this.search.focus(),_cursorToEnd(this.search)),this.debug("Dropdown opened.")}},close:function(){if(this.isInitialized()&&"open"===this.$me.state)return this.container.classList.remove("is-open","is-opening"),this.items.setAttribute("data-focused",-1),this.$me.state="closed",this.debug("Dropdown closed.")},triggerChange:function(){if(this.isInitialized()){this.$lock=!0;var event=document.createEvent("UIEvents");event.initUIEvent("change",!0,!0,window,1),this.$element.dispatchEvent(event),this.$lock=!1}},select:function(el){if(!this.isInitialized()||!(el instanceof HTMLDivElement)||!el.classList.contains("blobselect-item")||el.classList.contains("is-disabled"))return this.close();var value=el.dataset.value,options=this.getOptionsByValue(value);if(options.length)if(this.$me.multiple)for(i=0;i<options.length;i++)options[i].selected?(options[i].selected=0,this.debug('Unselected: "'+options[i].value+'"')):(options[i].selected=1,this.debug('Selected: "'+options[i].value+'"'));else this.$element.selectedIndex=options[0].index,this.debug('Selected: "'+options[0].value+'"');else this.$me.multiple||(this.$element.selectedIndex=this.$element.firstChild.index,this.debug('Selected: "'+this.$element.firstChild.value+'"'));this.close(),this.triggerChange(),this.buildData()},unselect:function(el){if(!(this.isInitialized()&&this.$me.multiple&&el instanceof HTMLDivElement&&(el.classList.contains("blobselect-selection")||el.classList.contains("blobselect-item"))))return this.close();var value=el.dataset.value||"",options=this.getOptionsByValue(value);for(i=0;i<options.length;i++)options[i].selected=0,this.debug('Unselected: "'+options[i].value+'"');this.close(),this.triggerChange(),this.buildData()},filterItems:function(fn,wait,no_postpone){function ping(){result=fn.apply(context||this,args||[]),context=args=null,executed=!0}function cancel(){timeout&&(clearTimeout(timeout),timeout=null)}function wrapper(){context=this,args=arguments,no_postpone?executed&&(executed=!1,timeout=setTimeout(ping,wait)):(cancel(),timeout=setTimeout(ping,wait))}var args,context,result,timeout,executed=!0;return wrapper.cancel=cancel,wrapper}(function(){if(!this.isInitialized()||!this.$settings.search)return!1;var items,me=this;if(me.$search){var needle=RegExp(_sanitizeRegExp(me.$search),"i"),replaceNeedle=RegExp(_sanitizeRegExp(me.$search),"gi"),matches=0;for(items=_find(me.items,".blobselect-item"),i=0;i<items.length;i++){var haystack=items[i].dataset.label,match=needle.test(haystack),classMatch=items[i].classList.contains("is-match"),classNoMatch=items[i].classList.contains("is-not-match");match&&matches++,items[i].classList.contains("is-placeholder")&&(haystack=me.$settings.placeholderOption),items[i].textContent=haystack,match?(classNoMatch&&items[i].classList.remove("is-not-match"),classMatch||items[i].classList.add("is-match"),items[i].innerHTML=haystack.replace(replaceNeedle,"<mark>$&</mark>")):(classNoMatch||items[i].classList.add("is-not-match"),classMatch&&items[i].classList.remove("is-match"))}if(matches)me.debug("Items filtered by search.");else{for(items=_find(me.items,".is-not-match, .is-match"),i=0;i<items.length;i++)items[i].classList.contains("is-not-match")&&items[i].classList.remove("is-not-match"),items[i].classList.contains("is-match")&&items[i].classList.remove("is-match"),items[i].innerHTML=items[i].textContent;me.debug("No items matched the search.")}}else for(items=_find(me.items,".is-not-match, .is-match"),i=0;i<items.length;i++)items[i].classList.contains("is-not-match")&&items[i].classList.remove("is-not-match"),items[i].classList.contains("is-match")&&items[i].classList.remove("is-match"),items[i].innerHTML=items[i].textContent},100),traverseItems:function(direction){var active=this.getActiveItem(),items=_find(this.items,".blobselect-item:not(.is-disabled):not(.is-not-match)"),activeIndex=items.indexOf(active)||-1,choice=null;if(-1===activeIndex){if(!items.length)return;activeIndex=0}return"current"===direction?choice=items[activeIndex]:"back"===direction?choice=activeIndex>0?items[activeIndex-1]:items[0]:"next"===direction&&(choice=activeIndex<items.length-1?items[activeIndex+1]:items[activeIndex.length-1]),choice.focus()},getActiveItem:function(){var choice,items=_find(this.items,".blobselect-item"),focused=parseInt(this.items.dataset.focused,10)||-1;if(focused>items.length-1&&(this.items.setAttribute("data-focused",-1),focused=-1),-1!==focused&&(choice=items[focused]),!choice||choice.classList.contains("is-disabled")||choice.classList.contains("is-not-match"))for(choice=null,i=0;i<items.length;i++)if(!items[i].classList.contains("is-disabled")&&!items[i].classList.contains("is-not-match")){choice=items[i];break}return choice},getItemsByValue:function(value,disabled){disabled=!!disabled,value+="";var out=[];for(i=0;i<this.$items.length;i++)"option"!==this.$items[i].type||this.$items[i].value!==value||!disabled&&this.$items[i].disabled||out.push(i);return out},getOptionsByValue:function(value,disabled){disabled=!!disabled,value+="";var out=[],options=_find(this.$element,"option");for(i=0;i<options.length;i++)options[i].value!==value||!disabled&&options[i].disabled||out.push(options[i]);return out},sort:function(arr){if(!Array.isArray(arr)||!arr.length)return[];if(!this.$settings.orderType)return arr;switch(this.$settings.orderType+this.$settings.order){case"stringASC":arr.sort(_sortStringAsc);break;case"stringDESC":arr.sort(_sortStringDesc);break;case"numericASC":arr.sort(_sortNumericAsc);break;case"numericDESC":arr.sort(_sortNumericDesc)}return arr},debug:function(str,warn){if(this.$settings.debug){var lead="blobSelect["+(new Date).toISOString().slice(0,19).replace("T"," ")+"] ";try{warn=!!warn,(str+="")&&(warn?console.warn(lead+str):console.log(lead+str))}catch(Ex){console.warn(lead+"Could not process debug message.")}}}},Object.defineProperty(HTMLSelectElement.prototype,"blobSelect",{get:function getter(){return Object.defineProperty(HTMLSelectElement.prototype,"blobSelect",{get:void 0}),Object.defineProperty(this,"blobSelect",{value:new blobSelect(this)}),Object.defineProperty(HTMLSelectElement.prototype,"blobSelect",{get:getter}),this.blobSelect},configurable:!0}),document.addEventListener("DOMContentLoaded",function(){var selects=document.querySelectorAll("select[data-blobselect], select[data-blobselect-watch], select[data-blobselect-search], select[data-blobselect-placeholder], select[data-blobselect-placeholder-option], select[data-blobselect-order], select[data-blobselect-order-type], select[data-blobselect-debug]");for(i=0;i<selects.length;i++)selects.item(i).blobSelect.init()});var _clickOutside=function(e){var selects=_find(document,".blobselect select");if(selects.length){if(!1!==_closest(e.target,".blobselect"))return!0;for(selects=_find(document,".blobselect.is-open select"),i=0;i<selects.length;i++)selects[i].blobSelect.close()}else clickOutside=!1,document.querySelector("html").removeEventListener("click",_clickOutside)},_JSON5={};_JSON5.parse=function(){"use strict";var r,e,n,t,i,f,o={"'":"'",'"':'"',"\\":"\\","/":"/","\n":"",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},a=[" ","\t","\r","\n","\v","\f"," ","\ufeff"],u=function(r){return""===r?"EOF":"'"+r+"'"},c=function(t){var f=new SyntaxError;throw f.message=t+" at line "+e+" column "+n+" of the JSON5 data. Still to read: "+JSON.stringify(i.substring(r-1,r+19)),f.at=r,f.lineNumber=e,f.columnNumber=n,f},s=function(f){return f&&f!==t&&c("Expected "+u(f)+" instead of "+u(t)),t=i.charAt(r),r++,n++,("\n"===t||"\r"===t&&"\n"!==l())&&(e++,n=0),t},l=function(){return i.charAt(r)},d=function(){var r=t;for("_"!==t&&"$"!==t&&(t<"a"||t>"z")&&(t<"A"||t>"Z")&&c("Bad identifier as unquoted key");s()&&("_"===t||"$"===t||t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9");)r+=t;return r},m=function(){var r,e="",n="",i=10;if("-"!==t&&"+"!==t||(e=t,s(t)),"I"===t)return("number"!=typeof(r=h())||isNaN(r))&&c("Unexpected word for number"),"-"===e?-r:r;if("N"===t)return r=h(),isNaN(r)||c("expected word to be NaN"),r;switch("0"===t&&(n+=t,s(),"x"===t||"X"===t?(n+=t,s(),i=16):t>="0"&&t<="9"&&c("Octal literal")),i){case 10:for(;t>="0"&&t<="9";)n+=t,s();if("."===t)for(n+=".";s()&&t>="0"&&t<="9";)n+=t;if("e"===t||"E"===t)for(n+=t,s(),"-"!==t&&"+"!==t||(n+=t,s());t>="0"&&t<="9";)n+=t,s();break;case 16:for(;t>="0"&&t<="9"||t>="A"&&t<="F"||t>="a"&&t<="f";)n+=t,s()}if(r="-"===e?-n:+n,isFinite(r))return r;c("Bad number")},N=function(){var r,e,n,i,f="";if('"'===t||"'"===t)for(n=t;s();){if(t===n)return s(),f;if("\\"===t)if(s(),"u"===t){for(i=0,e=0;e<4&&(r=parseInt(s(),16),isFinite(r));e+=1)i=16*i+r;f+=String.fromCharCode(i)}else if("\r"===t)"\n"===l()&&s();else{if("string"!=typeof o[t])break;f+=o[t]}else{if("\n"===t)break;f+=t}}c("Bad string")},b=function(){"/"!==t&&c("Not an inline comment");do{if(s(),"\n"===t||"\r"===t)return void s()}while(t)},p=function(){"*"!==t&&c("Not a block comment");do{for(s();"*"===t;)if(s("*"),"/"===t)return void s("/")}while(t);c("Unterminated block comment")},v=function(){"/"!==t&&c("Not a comment"),s("/"),"/"===t?b():"*"===t?p():c("Unrecognized comment")},y=function(){for(;t;)if("/"===t)v();else{if(!(a.indexOf(t)>=0))return;s()}},h=function(){switch(t){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null;case"I":return s("I"),s("n"),s("f"),s("i"),s("n"),s("i"),s("t"),s("y"),1/0;case"N":return s("N"),s("a"),s("N"),NaN}c("Unexpected "+u(t))},w=function(){var r=[];if("["===t)for(s("["),y();t;){if("]"===t)return s("]"),r;if(","===t?c("Missing array element"):r.push(f()),y(),","!==t)return s("]"),r;s(","),y()}c("Bad array")},g=function(){var r,e={};if("{"===t)for(s("{"),y();t;){if("}"===t)return s("}"),e;if(r='"'===t||"'"===t?N():d(),y(),s(":"),e[r]=f(),y(),","!==t)return s("}"),e;s(","),y()}c("Bad object")};return f=function(){switch(y(),t){case"{":return g();case"[":return w();case'"':case"'":return N();case"-":case"+":case".":return m();default:return t>="0"&&t<="9"?m():h()}},function(o,a){var u;return i=String(o),r=0,e=1,n=1,t=" ",u=f(),y(),t&&c("Syntax error"),"function"==typeof a?function r(e,n){var t,i,f=e[n];if(f&&"object"==typeof f)for(t in f)Object.prototype.hasOwnProperty.call(f,t)&&(void 0!==(i=r(f,t))?f[t]=i:delete f[t]);return a.call(e,n,f)}({"":u},""):u}}()}else console.warn("blobSelect["+(new Date).toISOString().slice(0,19).replace("T"," ")+"] aborted; browser missing feature support")}();
/**
*
* blobSelect
* version: 0.6
* home: https://blobfolio.com
*
* use:
*	<select data-blobselect="{OPTIONS}">
*	select fields with the data-blobselect attribute are auto-initialized on load
*	select fields can be manually initialized with:
*		new blobSelect(getElementById('the-field'))
*
* options:
*	orderType (string, numeric, null)
*		(string)
*		options will be resorted based on their values
*		default: null (i.e. no sort)
*	order (ASC, DESC)
*		(string)
*		options will be resorted up or down
*		default: ASC
*	placeholder (string)
*		mimics an input's placeholder attribute; this text is displayed when the
*		selection has no label
*		default: ---
*	placeholderOption (string)
*		this text is used when an option has no label
*		default: ---
*	search (bool)
*		a contentEditable field is placed at the top of the menu
*		to allow users to filter results
*		default: false
*
**/
(function(){function h(s,e){if(!s){return null}return typeof s==="string"?(e||document).querySelector(s):s}function q(s,e){return Array.prototype.slice.call((e||document).querySelectorAll(s))}function l(){try{document.querySelectorAll("select");if(typeof JSON!=="object"||typeof JSON.parse!=="function"){return false}return true}catch(s){return false}}function b(s,t){var e={};i(s,function(v,u){e[u]=s[u]});i(t,function(v,u){e[u]=t[u]});return e}function i(t,u){if(Object.prototype.toString.call(t)==="[object Object]"){for(var s in t){if(Object.prototype.hasOwnProperty.call(t,s)){u(t[s],s,t)}}}else{for(var s=0,e=t.length;s<e;s++){u(t[s],s,t)}}}function n(e){return e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}function d(u){try{var s=JSON.parse(u);return s}catch(t){return{}}}function g(e){i(e,function(s){s.parentNode.removeChild(s)})}function f(e,s,t){if(!e||typeof t!=="function"||!s){return false}e.addEventListener(s,t,false)}function c(s){var t=s.getAttribute("class");if(t===null){t=""}t=t.replace("/s{1,}/g"," ").trim();if(t.indexOf(" ")!==-1){return t.split(" ")}else{if(t.length){var e=[];e.push(t);return e}else{return[]}}}function j(s,t){var e=c(s);return e.indexOf(t)!==-1}function o(s,t){if(!j(s,t)){var e=c(s);e.push(t);s.setAttribute("class",e.join(" "))}return true}function a(t,u){var s=c(t),e=s.indexOf(u);if(e!==-1){s.splice(e,1);t.setAttribute("class",s.join(" "))}return true}var k={orderType:"",order:"ASC",placeholder:"---",placeholderOption:"---",search:false};var p=self.blobSelect=function(s){var e=this;if(typeof s!=="object"||s.tagName!=="SELECT"||!l()){return}e.element=s;e.status=parseInt(e.element.getAttribute("data-blobselected"))||0;e.settings=b(k,d(e.element.getAttribute("data-blobselect")));if(e.settings.search==="true"){e.settings.search=true}e.options={};e.selections=[];e.multiple=(e.element.getAttribute("multiple")===null)?false:true;e.events=[];e.updateLock=false;e.previous=[];if(e.status){return}if(e.settings.order&&["ASC","DESC"].indexOf(e.settings.order.toUpperCase())!==-1&&e.settings.orderType&&["string","numeric"].indexOf(e.settings.orderType.toLowerCase())!==-1){e.sortOptions()}e.build()};p.prototype={build:function(){var e=this;if(e.status){e.destroy()}var s=document.createElement("div");o(s,"blobselect");if(e.multiple){o(s,"is-multiple")}var v=e.element.tabIndex||0;s.tabIndex=v;e.element.tabIndex=-1;e.element.parentNode.insertBefore(s,e.element);var u=document.createElement("div");u.setAttribute("class","blobselect-selections");s.appendChild(u);s.appendChild(e.element);var t=document.createElement("div");o(t,"blobselect-button");s.appendChild(t);var w=document.createElement("div");w.setAttribute("class","blobselect-items");s.appendChild(w);if(e.settings.search===true){var x=document.createElement("div");o(x,"blobselect-item-search");x.setAttribute("type","text");x.setAttribute("contentEditable","true");w.appendChild(x)}i(q("optgroup, option",e.element),function(z){var y=[];if(z.tagName==="OPTGROUP"){y.push("blobselect-item-group")}else{y.push("blobselect-item");if(z.selected){y.push("is-active")}if(z.parentNode.tagName==="OPTGROUP"){y.push("has-group")}if(z.textContent.trim().length&&z.textContent.trim().toLowerCase()!==e.settings.placeholder.toLowerCase()){e.options[z.value]=z.textContent}else{e.options[z.value]=e.settings.placeholder;y.push("is-placeholder")}}var A=document.createElement("div");A.setAttribute("class",y.join(" "));if(z.tagName==="OPTGROUP"){A.textContent=z.label}else{A.setAttribute("tabIndex",1);A.setAttribute("data-value",z.value);A.textContent=z.textContent;if(!A.textContent.trim().length){A.textContent=e.settings.placeholderOption}}w.appendChild(A)});e.updateSelections();f(e.element,"change",function(){e.updateSelections()});f(e.element,"click",function(){e.updateSelections()});f(document.querySelector("html"),"click",function(y){if(j(e.element.parentNode,"is-open")){if(j(y.target.parentNode,"blobselect")||j(y.target,"blobselect")||/blobselect/.test(y.target.className)){return true}else{e.close()}}});i(q(".blobselect-item",e.element.parentNode),function(y){f(y,"click",function(A){A.stopPropagation();var z=y.getAttribute("data-value");if(e.selections.indexOf(z)!==-1){if(e.multiple){e.removeSelection(z)}}else{e.addSelection(z)}e.close()});f(y,"keyup",function(A){A.stopPropagation();var z=A.keyCode;if(z===13||z===32){return y.click()}})});f(s,"click",function(y){y.preventDefault();if(!j(this,"is-open")){e.open()}else{e.close()}});f(s,"keyup",function(z){var y=z.keyCode;if(!j(this,"is-open")&&(y===13||y===32)){return e.open()}else{if(j(this,"is-open")&&y===27){return e.close()}}});if(e.settings.search){f(x,"keyup",function(C){C.stopPropagation();var A=C.keyCode,y=n(x.textContent.trim()),z=q(".blobselect-item",x.parentNode.parentNode),B=0;i(z,function(G){var F=G.textContent.trim(),H=!y.length||RegExp(y,"i").test(F),E=!j(G,"is-not-match");G.textContent=F;if(H&&!E){a(G,"is-not-match")}else{if(!H&&E){o(G,"is-not-match")}}if(j(G,"is-not-match")&&j(G,"is-match")){a(G,"is-match")}else{if(!j(G,"is-not-match")&&!j(G,"is-match")){o(G,"is-match")}}if(H){G.innerHTML=F.replace(RegExp(y,"gi"),"<mark>$&</mark>")}if(H){B++}});if(!B){i(q(".is-not-match",x.parentNode.parentNode),function(E){a(E,"is-not-match")})}if(A===13){var D=h(".blobselect-item.is-match",x.parentNode.parentNode);if(D!==null){D.click()}else{e.close()}}else{if(A===27){e.close()}}});f(x,"click",function(y){y.stopPropagation()})}e.status=1;e.element.setAttribute("data-blobselected",1)},destroy:function(){var e=this;var s=e.element.parentNode;s.parentNode.insertBefore(e.element,s);g(q(".blobselect",s.parentNode));e.element.setAttribute("data-blobselected",0)},open:function(){var e=this,s=this.element.parentNode;if(j(s,"is-opening")||j(s,"is-open")){return true}i(q(".blobselect.is-open"),function(t){a(t,"is-open")});o(s,"is-opening");setTimeout(function(){o(s,"is-open");a(s,"is-opening");if(e.settings.search===true){setTimeout(function(){h(".blobselect-item-search",e.element.parentNode).textContent=h(".blobselect-item-search",e.element.parentNode).textContent.replace("/s/g"," ").trim();h(".blobselect-item-search",e.element.parentNode).focus()},100)}},50)},close:function(e){var e=this.element.parentNode;a(e,"is-open");e.focus()},updateSelections:function(){var e=this;if(e.updateLock){return}e.updateLock=true;if(!j(e.element.parentNode,"blobselect")){return}e.selections=[];i(q("option",e.element),function(s){if(s.selected){e.selections.push(s.value)}});var t=h(".blobselect-selections",e.element.parentNode);while(t.firstChild){t.removeChild(t.firstChild)}i(e.selections,function(w){var v=document.createElement("div");v.setAttribute("class","blobselect-selection");v.setAttribute("data-value",w);if(!w.trim().length||w.trim().toLowerCase()===e.settings.placeholder.toLowerCase()){o(v,"is-placeholder")}v.textContent=e.options[w];if(e.multiple){f(v,"click",function(s){s.stopPropagation();e.removeSelection(v.getAttribute("data-value"))})}h(".blobselect-selections",e.element.parentNode).appendChild(v)});i(q(".blobselect-item",e.element.parentNode),function(s){var v=e.selections.indexOf(s.getAttribute("data-value"))!==-1,w=j(s,"is-active");if(v&&!w){o(s,"is-active")}else{if(!v&&w){a(s,"is-active")}}});if(JSON.stringify(e.previous)!==JSON.stringify(e.selections)){var u=document.createEvent("UIEvents");u.initUIEvent("change",true,true,window,1);e.element.dispatchEvent(u);e.previous=e.selections}e.updateLock=false},removeSelection:function(s){var e=this;option=e.getOptionByValue(s);if(option!==false){option.selected=0;e.updateSelections();return true}return false},addSelection:function(u){var e=this,t=e.getOptionByValue(u),s=e.element.selectedIndex;if(t!==false){if(e.multiple){t.selected=1}else{e.element.selectedIndex=t.index}e.updateSelections();return true}return false},getOptionByValue:function(t){var e=this,s=false;i(q("option",e.element),function(u){if(u.value===t){s=u}});return s},sortOptions:function(){var e=q("option",this.element);if(this.settings.orderType.toLowerCase()==="string"){e.sort(this.sortByString)}else{if(this.settings.orderType.toLowerCase()==="numeric"){e.sort(this.sortByNumber)}}if(this.settings.order.toUpperCase()==="DESC"){e.reverse()}i(e,function(s){s.parentNode.appendChild(s)})},sortByString:function(s,e){return s.textContent.trim().toLowerCase().localeCompare(e.textContent.trim().toLowerCase())},sortByNumber:function(t,s){var u=Number(t.textContent.replace(/[^\d\.]/g,"")),e=Number(s.textContent.replace(/[^\d\.]/g,""));if(isNaN(u)){u=0}if(isNaN(e)){e=0}return u-e}};function r(){i(q("select[data-blobselect]"),function(e){new blobSelect(e)})}try{document.addEventListener("DOMContentLoaded",r)}catch(m){}})();